<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Biblia Cristiana RV 1960</title>
    <meta name="description" content="Aplicación de Biblia con modo offline y diseño premium">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <meta name="theme-color" content="#f4ece1">
    <script>
        (function () {
            const stored = JSON.parse(localStorage.getItem('bible_settings') || '{}');
            const style = stored.theme_style || 'classic';
            const mode = stored.system_theme ?
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') :
                (stored.theme_mode || 'light');
            document.documentElement.setAttribute('data-style', style);
            document.documentElement.setAttribute('data-mode', mode);

            // Clean service worker in Electron to prevent cache issues
            if (window.process && window.process.type === 'renderer' || navigator.userAgent.includes('Electron')) {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(registrations => {
                        for (let registration of registrations) {
                            registration.unregister();
                        }
                    });
                }
            }
        })();
    </script>
</head>

<body>
    <div id="title-bar" class="title-bar">
        <div class="title-drag">
            <img src="./icon.png" alt="Logo" class="title-logo">
            <span class="title-text">Biblia Cristiana RV 1960</span>
        </div>
        <div class="window-controls">
            <button class="control-btn" onclick="window.app.minimizeWindow()" title="Minimizar">
                <i data-lucide="minus"></i>
            </button>
            <button class="control-btn close" onclick="window.app.closeWindow()" title="Cerrar">
                <i data-lucide="x"></i>
            </button>
        </div>
    </div>
    <div id="sidebar"></div>
    <div id="app">
        <div id="splash"
            style="height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f4ece1; color: #3d2b1f; font-family: sans-serif;">
            <img src="./icon.png" alt="Logo"
                style="width: 80px; height: 80px; margin-bottom: 20px; animation: pulse 2s infinite;">
            <h2 style="margin-top: 20px; font-weight: 300;">Abriendo Biblia...</h2>
        </div>
    </div>

    <!-- Modal para Notas -->
    <div id="note-modal" class="modal-overlay">
        <div class="modal-box">
            <h2 class="modal-title">Escribir Nota <span style="font-size: 0.6rem; opacity: 0.3;">v1.2.4</span></h2>
            <p id="note-verse-ref" class="modal-subtitle"></p>
            <input type="text" id="note-title" class="modal-input" placeholder="Título de la nota (opcional)">
            <textarea id="note-text" class="modal-textarea"
                placeholder="¿Qué te dice Dios en este versículo?..."></textarea>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="window.app.closeNoteModal()">Cancelar</button>
                <button class="modal-btn primary" onclick="window.app.saveNoteFromModal()">Guardar Nota</button>
            </div>
        </div>
    </div>

    <!-- Modal para Compartir -->
    <div id="share-modal" class="modal-overlay">
        <div class="modal-box" style="text-align: center;">
            <h2 class="modal-title">Compartir Versículo</h2>
            <p class="modal-subtitle">¿Cómo deseas compartirlo?</p>
            <div style="display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 1rem;">
                <button class="premium-card" onclick="window.app.shareVerse('image')"
                    style="flex-direction: row; justify-content: center; gap: 1rem; padding: 1.25rem;">
                    <i id="share-modal-img-icon" data-lucide="image"></i> <b id="share-modal-img-text">Compartir
                        Imagen</b>
                </button>
                <button class="premium-card" onclick="window.app.shareVerse('text')"
                    style="flex-direction: row; justify-content: center; gap: 1rem; padding: 1.25rem;">
                    <i id="share-modal-txt-icon" data-lucide="copy"></i> <b id="share-modal-txt-text">Copiar Texto</b>
                </button>
            </div>
            <div class="modal-actions" style="margin-top: 2rem; justify-content: center;">
                <button class="modal-btn secondary" onclick="window.app.closeShareModal()"
                    style="width: 100%;">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal Especial (Easter Egg) -->
    <div id="love-modal" class="modal-overlay love-modal">
        <div class="modal-box" style="text-align: left; max-height: 85vh; overflow-y: auto;">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <h2 class="modal-title">1 Corintios 13:4-7</h2>
                <div style="color: #d63384; font-size: 1.5rem; margin-top: 0.5rem;">❤</div>
            </div>

            <div class="bible-verse">
                <b>1 Corintios 13:4</b><br>
                El amor es sufrido, es benigno; el amor no tiene envidia, el amor no es jactancioso, no se envanece;
            </div>
            <div class="bible-verse">
                <b>1 Corintios 13:5</b><br>
                no hace nada indebido, no busca lo suyo, no se irrita, no guarda rencor;
            </div>
            <div class="bible-verse">
                <b>1 Corintios 13:6</b><br>
                no se goza de la injusticia, mas se goza de la verdad.
            </div>
            <div class="bible-verse">
                <b>1 Corintios 13:7</b><br>
                Todo lo sufre, todo lo cree, todo lo espera, todo lo soporta.
            </div>

            <p class="dedication">
                En dedicacion a la mujer que amo, katherine mi niña, que mi Dios te cuide siempre a donde vayas y que
                nunca te apartes de su hermoso camino a la salvacion, estes donde estes siempre tendras un espacio en mi
                corazon ❤
            </p>

            <button class="modal-btn close-love" onclick="window.app.closeLoveModal()">Cerrar</button>
        </div>
    </div>
    <!-- Barras de herramientas flotantes para Favoritos y Notas -->
    <div id="fav-selection-bar" class="floating-toolbar animate-entrance" style="display: none;">
        <button class="tool-btn" onclick="window.app.confirmDeleteFavoriteFromBar()" title="Eliminar Favorito"
            style="color: #ef4444;">
            <i data-lucide="trash-2"></i>
        </button>
        <button class="tool-btn" onclick="window.app.navigateToSelectedFavorite()" title="Ir al Versículo"
            style="color: var(--accent);">
            <i data-lucide="external-link"></i>
        </button>
        <button class="tool-btn" onclick="window.app.clearFavoriteSelection()" title="Cerrar">
            <i data-lucide="x"></i>
        </button>
    </div>

    <div id="note-selection-bar" class="floating-toolbar animate-entrance" style="display: none;">
        <button class="tool-btn" onclick="window.app.handleEditNoteFromBar()" title="Editar Nota">
            <i data-lucide="edit-3"></i>
        </button>
        <button class="tool-btn" onclick="window.app.confirmDeleteNoteFromBar()" title="Eliminar Nota"
            style="color: #ef4444;">
            <i data-lucide="trash-2"></i>
        </button>
        <button class="tool-btn" onclick="window.app.clearNoteSelection()" title="Cerrar">
            <i data-lucide="x"></i>
        </button>
    </div>

    <!-- Modal de Confirmación -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-box" style="text-align: center;">
            <h2 class="modal-title" id="confirm-title">¿Confirmar?</h2>
            <p id="confirm-msg" class="modal-subtitle" style="margin-bottom: 2rem;"></p>
            <div class="modal-actions" style="justify-content: center; gap: 1rem;">
                <button class="modal-btn secondary" onclick="window.app.closeConfirmModal()"
                    style="flex: 1;">Cancelar</button>
                <button class="modal-btn primary" id="confirm-btn-ok"
                    style="flex: 1; background: #ef4444;">Eliminar</button>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <script>
        const isElectron = window.process && window.process.type === 'renderer' || navigator.userAgent.includes('Electron');
        if (window.location.protocol === 'file:' && !isElectron) {
            alert('¡Atención! Las aplicaciones web modernas (PWA) no funcionan al abrir el archivo directamente. \n\nPor favor, usa el comando "npm run dev" en tu terminal para ejecutar la aplicación correctamente.');
            document.body.innerHTML = `
        <div style="height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #0B4C5F; color: white; text-align: center; padding: 2rem; font-family: sans-serif;">
          <h1>⚠️ Error de Ejecución</h1>
          <p style="margin: 1rem 0;">No se puede ejecutar la Biblia directamente desde el archivo.</p>
          <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; font-family: monospace; margin-bottom: 1rem;">
            npm run dev
          </div>
          <p style="font-size: 0.9rem; opacity: 0.7;">Ejecuta el comando anterior en tu terminal.</p>
        </div>
      `;
        }

        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => {
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                window.location.reload();
                            }
                        };
                    };
                });
            });
        }

        window.resetApp = async () => {
            if ('serviceWorker' in navigator) {
                const regs = await navigator.serviceWorker.getRegistrations();
                for (let reg of regs) await reg.unregister();
            }
            const cacheNames = await caches.keys();
            for (let name of cacheNames) await caches.delete(name);
            localStorage.clear();
            window.location.reload();
        };
    </script>
    <div id="toast-container" class="toast-container"></div>
    <script type="module" src="./src/js/main.js"></script>
</body>

</html>